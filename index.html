<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<title>MQWeb App</title>
		<link rel="stylesheet" href="bower_components/uikit/css/uikit.gradient.min.css" />
		<script src="bower_components/jquery/dist/jquery.min.js" type="text/javascript"></script>
		<script src="bower_components/uikit/js/uikit.min.js" type="text/javascript"></script>
		<link rel="stylesheet" href="bower_components/uikit/css/components/autocomplete.gradient.min.css" />
		<script src="bower_components/uikit/js/uikit.min.js" type="text/javascript"></script>
		<script src="bower_components/uikit/js/components/autocomplete.min.js" type="text/javascript"></script>
		<script src="bower_components/vue/dist/vue.js" type="text/javascript"></script>
		<script src="bower_components/es6-promise/promise.min.js" type="text/javascript"></script>
		<script src="bower_components/fetch/fetch.js" type="text/javascript"></script>
		<script src="bower_components/lockr/lockr.min.js" type="text/javascript"></script>
		<style>
	 	.loader {
			background-image: url(data:image/gif;base64,R0lGODlhEAALAPQAAP///0pISOTk5N3d3e/v705MTEpISGpoaKalpY6MjM3NzWJgYH59fauqqpCPj9DQ0GRjY0xKSoF/f+zs7OPi4vb29nFwcOXl5fX19crKyru6utnY2PLy8gAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCwAAACwAAAAAEAALAAAFLSAgjmRpnqSgCuLKAq5AEIM4zDVw03ve27ifDgfkEYe04kDIDC5zrtYKRa2WQgAh+QQJCwAAACwAAAAAEAALAAAFJGBhGAVgnqhpHIeRvsDawqns0qeN5+y967tYLyicBYE7EYkYAgAh+QQJCwAAACwAAAAAEAALAAAFNiAgjothLOOIJAkiGgxjpGKiKMkbz7SN6zIawJcDwIK9W/HISxGBzdHTuBNOmcJVCyoUlk7CEAAh+QQJCwAAACwAAAAAEAALAAAFNSAgjqQIRRFUAo3jNGIkSdHqPI8Tz3V55zuaDacDyIQ+YrBH+hWPzJFzOQQaeavWi7oqnVIhACH5BAkLAAAALAAAAAAQAAsAAAUyICCOZGme1rJY5kRRk7hI0mJSVUXJtF3iOl7tltsBZsNfUegjAY3I5sgFY55KqdX1GgIAIfkECQsAAAAsAAAAABAACwAABTcgII5kaZ4kcV2EqLJipmnZhWGXaOOitm2aXQ4g7P2Ct2ER4AMul00kj5g0Al8tADY2y6C+4FIIACH5BAkLAAAALAAAAAAQAAsAAAUvICCOZGme5ERRk6iy7qpyHCVStA3gNa/7txxwlwv2isSacYUc+l4tADQGQ1mvpBAAIfkECQsAAAAsAAAAABAACwAABS8gII5kaZ7kRFGTqLLuqnIcJVK0DeA1r/u3HHCXC/aKxJpxhRz6Xi0ANAZDWa+kEAA7AAAAAAAAAAAA);
			width: 100%;
			height: 16px;
			background-position: center;
			background-repeat: no-repeat;
		}
	  </style>
	</head>
	<body id="app" data-uk-observe="">
		<div class="uk-container uk-container-center uk-margin-top uk-margin-large-bottom">
	 		<div class="uk-grid" data-uk-grid-margin="">
				<div class="uk-width-1-1">
					<div style="float:right;margin:10px;">
						<a href="https://github.com/fbraem/mqwebapp"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>
					</div>
					<nav class="uk-navbar">
						<a href="#" class="uk-navbar-brand">MQWeb</a>
						<ul class="uk-navbar-nav">
						</ul>
						<div class="uk-navbar-content">
							<div id="queueManagerAutoComplete" class="uk-autocomplete uk-form" data-uk-autocomplete="" >
								<input type="text" v-model="search" placeholder="Queuemanager" />
								<button v-on:click.prevent="add" v-bind:disabled="queueManager.length == 0" class="uk-button uk-button-primary">Add</button>
							</div>
						</div>
					</nav>
				</div>
	 		</div>
			<div v-if="queueManagers.length == 0" class="uk-grid" data-uk-grid-margin="">
				<div class="uk-width-1-1">
					<p>
						Please add some queuemanagers to this page using the entryfield in the navigation bar.
						Start typing the name of a queuemanager and you'll get a list to select from. If you
						don't know the name or don't see any queuemanager listed, contact your WebSphere MQ administrator.
					</p>
					<p>
						Once a queuemanager is added it will be stored in your local storage.
					</p>
				</div>
			</div>
	 		<div class="uk-grid" data-uk-grid-margin="">
	 			<div class="uk-width-medium-1-3 uk-row-first">
	 				<div class="uk-panel uk-panel-box">
						<a href="#" style="float:right;" class="uk-close"></a>
	 					<h3 class="uk-panel-title">PIGEON<span style="float:right;margin-right:10px;margin-top:2px" class="uk-badge uk-badge-success">Ok</span></h3>
	 					<hr />
	 					<blockquote>
	 						Test queuemanager for MQWeb
	 					</blockquote>
						<p class="uk-alert">Checking connection ... <span class="loader">&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
	 				</div>
	 			</div>
	 			<div class="uk-width-medium-1-3">
	 				<div class="uk-panel uk-panel-box">
						<a href="#" style="float:right;" class="uk-close"></a>
	 					<h3 class="uk-panel-title">BLACKBIRD<span style="float:right;margin-right:10px;margin-top:2px" class="uk-badge uk-badge-danger">Error</span></h3>
	 					<hr />
	 					<p>Checking connection ...</p>
	 				</div>
	 			</div>
	 			<div class="uk-width-medium-1-3">
	 				<div class="uk-panel uk-panel-box">
						<a href="#" style="float:right;" class="uk-close"></a>
	 					<h3 class="uk-panel-title">SPARROW<span style="float:right;margin-right:10px;margin-top:2px" class="uk-badge">Checking</span></h3>
	 					<hr />
	 				</div>
	 			</div>
				<div v-for="qmgr in queueManagers" class="uk-width-medium-1-3">
					<div class="uk-panel uk-panel-box">
						<a href="#" style="float:right;" class="uk-close"></a>
						<h3 class="uk-panel-title">{{ qmgr.name }}<span style="float:right;margin-right:10px;margin-top:2px" class="uk-badge">Checking</span></h3>
						<hr />
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript">

			// Creates a promise to get data. There is already a promise added
			// to transform the returned data into JSON. Additional promises will
			// get this JSON data as argument. When response status code is < 200
			// or > 300 an error will be thrown.
			function getJSON(url) {
				return fetch(url, {
					credentials : 'same-origin'
				}).then(function(response) {
					if ( response.status >= 200 && response.status < 300 ) {
						return response.json();
					} else {
						var error = new Error(response.statusText);
						error.response = response;
						throw error;
					}
				});
			}

			$(document).ready(function() {

				var availableQueueManagers = [];
				getJSON("/api/mqweb/list").then(function(data) {
					availableQueueManagers = data.queuemanagers;
					console.log(availableQueueManagers);
				});

				var autocomplete = $.UIkit.autocomplete($('#queueManagerAutoComplete'), {
					'source' : function(release) {
						var search = vm.$data.search;
						var qmgrs = [];
						for(var qmgr in availableQueueManagers ) {
							var qmgrName = availableQueueManagers[qmgr];
							if ( qmgrName.toLowerCase().indexOf(search.toLowerCase()) > -1 ) {
								qmgrs.push({ value : availableQueueManagers[qmgr]});
							}
						}
						return release(qmgrs);
					}
 				});

				Vue.config.debug = true;

				var vm = new Vue({
					data : function() {
						return {
							queueManager : '',
							search : '',
							queueManagers : []
						};
					},
					el : '#app',
					ready : function() {
						this.queueManagers = Lockr.get('queueManagers', []);
					},
					methods : {
						add : function() {
							this.queueManagers.push({ name : this.queueManager });
							this.queueManager = '';
							this.search = '';
							Lockr.set("queueManagers", this.queueManagers);
						}
					},
					watch : {
						search : function(nv, ov) {
							if ( this.queueManager != nv ) {
								this.queueManager = '';
							}
						},
						queueManagers : function(nv, ov) {
							console.log(this.queueManagers);
						}
					}
				});

				autocomplete.on('selectitem.uk.autocomplete', function(e, data, ac) {
					vm.$set('queueManager', data.value);
				});

			});
		</script>
	</body>
</html>
